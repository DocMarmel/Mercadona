<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>Mercadona - Tableau de bord</title>

<!--        CDN Bootstrap-->
<!--        <link rel="stylesheet"-->
<!--              href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"-->
<!--              integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"-->
<!--              crossorigin="anonymous">-->
    </head>
    <style>
        .promo {
            font-weight: bold;
            color: red;
        }
    </style>
    <body>

        <nav>
            <ul>
                <li><a href="/">Accueil</a></li>
                <li><a href="/catalog">Catalogue</a></li>
                <li th:if="${authentication != null}"><a href="/login">Connexion</a></li>
                <li th:if="${authentication != null}"><a href="/logout">Déconnexion</a></li>
                <li th:if="${authentication != null}"><a href="/register">Inscription</a></li>
                <li th:if="${authentication != null}"><a href="/dashboard">Tableau de bord</a></li>
            </ul>
        </nav>

        <h1>Tableau de bord</h1>

        <h2>Liste des produits</h2>

        <a th:href="@{/product/create}">Ajouter un produit</a>

        <table>
            <thead>
            <tr>
                <th>Nom du produit</th>
                <th>Description</th>
                <th>Prix</th>
                <th>Catégorie</th>
                <th>Promotion</th>
                <th>Date de début de promotion</th>
                <th>Date de fin de promotion</th>
                <th>Pourcentage de remise</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
                <tr th:each="product : ${products}">
                    <td th:text="${product.label}" />
                    <td th:text="${product.description}" />
                    <td th:text="${product.promotion ? (product.price - (product.price * (product.discountPercentage ?: 0) / 100)) + '€' : product.price + '€'}"
                        th:class="${product.promotion ? 'promo' : ''}"/>
                    <td th:text="${product.category}" />
                    <td th:text="${product.promotion ? 'Oui' : 'Non'}" />
                    <td th:text="${product.startDatePromo != null ? product.startDatePromo : 'Pas de promotion'}" />
                    <td th:text="${product.endDatePromo != null ? product.endDatePromo : 'Pas de promotion'}" />
                    <td th:text="${(product.discountPercentage == null || product.discountPercentage == 0) ? 'Pas de promotion' : product.discountPercentage + '%'}" />
                    <td>
                        <a th:href="@{/dashboard/products/edit/{id}(id=${product.id})}">Modifier le produit</a>

                        <form th:action="@{/dashboard/products/delete/{id}(id=${product.id})}" method="post">
                            <button type="submit">Supprimer le produit</button>
                        </form>
                    </td>
                </tr>
            </tbody>
        </table>
    </body>
</html>
